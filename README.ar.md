# غالا غوفر

### ما هو غالا جوفر

Gala-gopher عبارة عن منصة مراقبة تجمع بين eBPF وعامل جافا وتقنيات أخرى غير تدخلية يمكن ملاحظتها ، ويمكنها بسهولة زيادة وتقليل المجسات من خلال البنية القائمة على المسبار. Gala-gopher هو المكون المسؤول عن جمع البيانات في مشروع غالا. ويوفر بيانات مثل المقاييس والحدث والكمال لمشروع غالا ، وهو مناسب لمشروع غالا لاستكمال رسم طوبولوجيا النظام وموقع السبب الجذري للخطأ.

### استخدم حالات

#### شبكة الرصد

#### التحكم في الإدخال / الإخراج

#### مراقبة أداء التطبيق

#### تنميط أداء التطبيق

#### مجموعة طوبولوجيا الشبكة

### دليل التثبيت

#### نشر RPM

-   احصل على حزمة rpm

    تم إصدار Gala-gopher حاليًا في openEuler 21.09 (توقفت الصيانة) / openEuler 22.09 (توقفت الصيانة) / openEuler 22.03-LTS-SP1 ، ويمكن الحصول على حزمة rpm عن طريق تكوين مصدر الريبو الرسمي لإصدار الإصدار أعلاه ؛ لإصدار آخر إصدارات نحن يتم توفير الطرق التالية للحصول على حزم rpm:

    -   رابط OBS: قم بتنزيل حزمة rpm للبنية المقابلة يدويًا من صفحة الويب

    ```basic
    openEuler-20.03-LTS : https://117.78.1.88/package/show/home:zpublic:branches:openEuler:20.03:LTS:SP1/gala-gopher-20.03lts
    openEuler-20.03-LTS-SP1 : https://117.78.1.88/package/show/home:zpublic:branches:openEuler:20.03:LTS:SP1/gala-gopher
    EulerOS-V2R9 : https://117.78.1.88/package/show/home:zpublic:branches:openEuler:20.03:LTS:SP1/gala-gopher-v2r9
    ```

    -   مصدر بناء الريبو اليومي: قم بالتثبيت بعد تكوينه كمصدر yum

    ```basic
    openEuler 22.03-LTS: http://121.36.84.172/dailybuild/openEuler-22.03-LTS/openEuler-22.03-LTS/EPOL/main/
    ```

-   تثبيت rpm

    ```bash
    yum install gala-gopher
    ```

-   يجري

    ابدأ خدمة الخلفية عبر systemd:

    ```bash
    systemctl start gala-gopher.service
    ```

#### نشر الحاويات

-   احصل على صورة الحاوية

    يمكن للمستخدمين الاختيار مباشرة[احصل على صور حاوية رسمية](#docker1)أو بنفسك[بناء صورة حاوية](#docker2)

    <a id="docker1"></a>

    -   احصل على صور حاوية رسمية

        أضف المحتوى التالي إلى ملف تكوين عامل الإرساء /etc/docker/daemon.json (إذا لم يكن الملف موجودًا ، فيجب إنشاؤه) لإضافة مستودع مرآة hub.oepkgs.net

            {
              "insecure-registries" : [ "hub.oepkgs.net" ]
            }

        بعد الانتهاء ، أعد تشغيل خدمة docker باستخدام الأمر التالي لجعل التكوين ساري المفعول:

            systemctl daemon-reload
            systemctl restart docker


    根据系统架构从对应仓库拉取指定版本的gala-gopher官方容器镜像（以openEuler 20.03 LTS SP1为例）：

    ```
    # x86
    docker pull hub.oepkgs.net/a-ops/gala-gopher-x86_64:20.03-lts-sp1

    # aarch64
    docker pull hub.oepkgs.net/a-ops/gala-gopher-aarch64:20.03-lts-sp1
    ```

    目前支持的镜像版本tag有：euleros-v2r9（仅支持x86），20.03-lts，20.03-lts-sp1，22.03-lts，22.03-lts-sp1

<a id="docker2"></a>

-   بناء صورة حاوية

    الحصول على حزمة rpm من gala-gopher. لمزيد من التفاصيل ، انظر[نشر RPM](#RPM方式部署)。

    تم أرشفة ملف Docker المستخدم لإنشاء صورة الحاوية في[بناء الدليل](./build)، راجع طريقة التوليد للحصول على التفاصيل[كيفية إنشاء صورة حاوية غالا غوفر](doc/how_to_build_docker_image.md)。

-   إنشاء وتشغيل الحاوية

    يتضمن Gala-gopher ملفي تكوين: gala-gopher.conf و gala-gopher-app.conf. يستخدم gala-gopher.conf بشكل أساسي لتكوين مفتاح الإبلاغ عن البيانات للمسبار ، ومعلمات التحقيق ، وما إذا كان المسبار ممكّنًا ، وما إلى ذلك ؛ gala-gopher-app.conf هي القائمة البيضاء للملاحظة ، والتي يمكنها إضافة اسم العملية الذي يهتم المستخدم بالقائمة البيضاء. سيراقب غالا غوفر هذه العملية.

    قبل بدء الحاوية ، يحتاج المستخدم إلى تكوين ملفي التكوين هذين. الرجاء إنشاء دليل ملف التكوين على المضيف وتعيين[دليل التكوين](./config)يتم حفظ ملفي التكوين التاليين في هذا الدليل ، والأمثلة على النحو التالي:

    ```shell
    [root@localhost ~]# mkdir gopher_user_conf
    [root@localhost gopher_user_conf]# ll
    total 8.0K
    -rw-r--r--. 1 root root 3.2K Jun 28 09:43 gala-gopher.conf
    -rw-r--r--. 1 root root  108 Jun 27 21:45 gala-gopher-app.conf
    ```

    تابع من فضلك[مقدمة ملف التكوين](./doc/conf_introduction.md)تخصيص ملفات التكوين. عند تنفيذ أمر docker run ، تحتاج إلى تعيين دليل ملف التكوين المخصص على المضيف إلى الدليل / gala-gopher / user_conf في الحاوية ، وذلك لمزامنة معلومات التكوين المخصصة في الحاوية.

    أخيرًا ، ابدأ الحاوية وفقًا لأمر المثال التالي:

    ```shell
    docker run -d --name xxx -p 8888:8888 --privileged -v /etc/machine-id:/etc/machine-id -v /lib/modules:/lib/modules:ro -v /usr/src:/usr/src:ro -v /boot:/boot:ro -v /sys/kernel/debug:/sys/kernel/debug -v /sys/fs/bpf:/sys/fs/bpf -v /root/gopher_user_conf:/gala-gopher/user_conf/ -v /etc/localtime:/etc/localtime:ro -v /var/run/docker.sock:/var/run/docker.sock -v /var/lib/docker/overlay2:/var/lib/docker/overlay2 --pid=host gala-gopher:1.0.1
    ```

    بعد بدء تشغيل الحاوية بنجاح ، يمكنك رؤية الحاوية قيد التشغيل من خلال docker ps:

    ```shell
    [root@localhost build]# docker ps
    CONTAINER ID   IMAGE               COMMAND                  CREATED              STATUS              PORTS                    NAMES
    eaxxxxxxxx02   gala-gopher:1.0.1   "/bin/sh -c 'cp -f /…"   About a minute ago   Up About a minute   0.0.0.0:8888->8888/tcp   xxx
    ```

-   استرداد البيانات

    كما هو موضح في أمر Docker run في الخطوة أعلاه ، قمنا بتعيين المنفذ 8888 للمضيف والمنفذ 8888 للحاوية ، حتى نتمكن من الحصول على البيانات من خلال المنفذ 8888 للتحقق مما إذا كان gala-gopher يعمل بنجاح:

    ```shell
    [root@localhost build]# curl http://localhost:8888
    ...
    gala_gopher_udp_que_rcv_drops{tgid="1234",s_addr="192.168.12.34",machine_id="xxxxx",hostname="eaxxxxxxxx02"} 0 1656383357000
    ...
    ```

    إذا كان هناك إخراج بيانات مؤشر ، فإنه يثبت أن gala-gopher يعمل بنجاح.

#### نشر وضع نشر K8S

#### 

#### النشر الآلي للبرنامج النصي

-   احصل على أدوات النشر

    1.  قم بتنزيل الحزمة المضغوطة لأداة النشر: wget[هتبص://جيتي.كوم/فكانجر/بسطلص/ريبستر/أرشيف/ماستر.ذيب](https://gitee.com/Vchanger/a-ops-tools/repository/archive/master.zip)--لا تحقق من الشهادة (يحتاج مستخدمو الإنترانت إلى تكوين الوكيل)
    2.  استخدم unzip لفك ضغط الحزمة المضغوطة وأدخل الدليل المقابل لاستخدامها

-   قم بتنفيذ البرنامج النصي للأداة للنشر

    -   وضع rpm (يتم دعم openEuler 22.03 LTS / openEuler 22.03 LTS SP1 فقط)

            sh deploy.sh gopher -K <kafka服务器地址>

    -   طريقة انعكاس الحاوية:

            sh deploy.sh gopher -K <kafka服务器地址> --docker --tag <容器镜像tag>

        ملاحظة: علامات إصدار الصورة المدعومة حاليًا هي: euleros-v2r9 (يدعم x86 فقط) ، 20.03-lts ، 20.03-lts-sp1 ، 22.03-lts ، 22.03-lts-sp1

    بعد الانتهاء من الخطوتين السابقتين ، يمكن لـ gala-gopher الدخول في حالة التشغيل. للتعرف على قيود الاستخدام وجميع خيارات أداة النشر ، يرجى الرجوع إلى[دليل أداة نشر أدوات A-Ops](https://gitee.com/Vchanger/a-ops-tools#部署gala-gopher)

#### تكامل النظام API والطريقة

#### طريقة التكوين والمعلمات

[طريقة التكوين والمعلمات](https://gitee.com/openeuler/gala-gopher/blob/master/doc/conf_introduction.md#配置文件介绍)

### هيكلة البرمجيات

يدمج غالا غوفر مجسات أصلية شائعة الاستخدام وتحقيقات برمجية وسيطة معروفة ؛ تتمتع جالا غوفر بقابلية جيدة للتوسع ، ويمكنها بسهولة دمج أنواع مختلفة من برامج التحقيق ، وتعزز قوة المجتمع لإثراء قدرات إطار عمل المسبار ؛ حفل - عدة المكونات الرئيسية في غوفر:

-   إطار غالا غوفر

    يعد الإطار الأساسي لـ gala-gopher مسؤولاً عن تحليل ملف التكوين ، وإدارة المجسات الأصلية / تحقيقات التمديد ، وإدارة جمع بيانات المسبار ، وإرساء تقارير بيانات التحقيق ، واختبار التكامل ، وما إلى ذلك ؛

-   مسبار أصلي

    المجسات الأصلية هي في الأساس مؤشرات مراقبة النظام التي تم جمعها بناءً على نظام ملفات proc القائم على Linux ؛

-   تمديد التحقيق

    يدعم برامج التحقيق التابعة لجهات خارجية بلغات مختلفة مثل shell / java / python / c ، ويمكن دمجها في إطار عمل gala-gopher فقط من خلال تلبية تنسيق تقارير البيانات خفيف الوزن ؛ من الملائم تلبية متطلبات المراقبة بمختلف سيناريوهات التطبيق ؛ تحقق حاليًا من مراقبة الفحص وتقرير الفهرس للبرامج الوسيطة المعروفة ، مثل: lvs و nginx و haproxy و dnsmasq و dnsbind و kafka و rabbitmq وما إلى ذلك ؛

-   ملف تكوين النشر

    يمكن لملف تكوين بدء التشغيل gala-gopher تخصيص المجسات الممكّنة المحددة وتحديد معلومات خدمة الإرساء لتقارير البيانات (kafka / prometheus ، إلخ.)

### كيف تساهم

#### بناء من المصدر

#### بناء حزمة rpm

#### دليل تطوير المسبار

[دليل تطوير المسبار](https://gitee.com/openeuler/gala-gopher/blob/master/doc/how_to_add_probe.md)

![devops](D:/GiteeCode/fork/gala-gopher/doc/pic/devops.JPG)

#### كيفية إضافة مسبار

[كيفية إضافة مسبار أصلي](https://gitee.com/openeuler/gala-gopher/blob/master/doc/how_to_add_probe.md#如何新增native探针)

[كيفية إضافة مسبار يمتد](https://gitee.com/openeuler/gala-gopher/blob/master/doc/how_to_add_probe.md#如何新增extends探针)

#### كيفية اقتصاص مسبار

[كيفية تحقيق قص المجس](https://gitee.com/openeuler/gala-gopher/blob/master/doc/how_to_tail_probe.md)

### خريطة الطريق

#### القدرة على التفتيش

| صفة مميزة                                                             | وقت الافراج | الإصدار                               |
| --------------------------------------------------------------------- | ----------- | ------------------------------------- |
| فحص TCP غير طبيعي                                                     | ٢٢.١٢       | openEuler 22.03 SP1                   |
| فحص المقبس غير طبيعي                                                  | ٢٢.١٢       | openEuler 22.03 SP1                   |
| فحص استثناء استدعاء النظام                                            | ٢٢.١٢       | openEuler 22.03 SP1                   |
| عملية فحص استثناء الإدخال / الإخراج                                   | ٢٢.١٢       | openEuler 22.03 SP1                   |
| فحص استثناء حظر الإدخال / الإخراج                                     | ٢٢.١٢       | openEuler 22.03 SP1                   |
| فحص تسرب الموارد غير الطبيعي                                          | ٢٢.١٢       | openEuler 22.03 SP1                   |
| فحص أعطال الأجهزة (القرص / بطاقة الشبكة / الذاكرة)                    | ٢٣.٠٩       | openEuler 22.03 SP1 ، openEuler 23.03 |
| فحص استثناء JVM                                                       | ٢٣.٠٩       | openEuler 22.03 SP1 ، openEuler 23.03 |
| مكدس الشبكة المضيفة (بما في ذلك المحاكاة الافتراضية) فحص فقدان الحزمة | ٢٣.٠٩       | openEuler 22.03 SP1 ، openEuler 23.03 |

#### الملاحظة

| صفة مميزة                                                                                    | وقت الافراج | الإصدار                               |
| -------------------------------------------------------------------------------------------- | ----------- | ------------------------------------- |
| قدرة مراقبة بروتوكول التحكم في الإرسال على مستوى العملية                                     | ٢٢.١٢       | openEuler 22.03 SP1                   |
| القدرة على مراقبة المقبس على مستوى العملية                                                   | ٢٢.١٢       | openEuler 22.03 SP1                   |
| إمكانية مراقبة الإدخال / الإخراج كاملة التخزين الموزعة                                       | ٢٢.١٢       | openEuler 22.03 SP1                   |
| القدرة على مراقبة I / O للتخزين الافتراضي                                                    | ٢٢.١٢       | openEuler 22.03 SP1                   |
| القدرة على مراقبة Block I / O                                                                | ٢٢.١٢       | openEuler 22.03 SP1                   |
| القدرة على مراقبة تشغيل الحاويات                                                             | ٢٢.١٢       | openEuler 22.03 SP1                   |
| قدرة Redis على مراقبة الأداء                                                                 | ٢٢.١٢       | openEuler 22.03 SP1                   |
| القدرة على مراقبة أداء PG                                                                    | ٢٢.١٢       | openEuler 22.03 SP1                   |
| القدرة على مراقبة جلسة Nginx                                                                 | ٢٢.١٢       | openEuler 22.03 SP1                   |
| القدرة على مراقبة جلسة Haproxy                                                               | ٢٢.١٢       | openEuler 22.03 SP1                   |
| قدرة مراقبة جلسة كافكا                                                                       | ٢٢.١٢       | openEuler 22.03 SP1                   |
| القدرة على مراقبة أداء JVM                                                                   | ٢٣.٠٦       | openEuler 22.03 SP1 ، openEuler 23.03 |
| قدرة مراقبة بروتوكول L7 (HTTP1.X / MySQL / PGSQL / Redis / Kafka)                            | ٢٣.٠٩       | openEuler 22.03 SP1 ، openEuler 23.03 |
| قدرة مراقبة بروتوكول L7 (HTTP1.X / MySQL / PGSQL / Redis / Kafka / MongoDB / DNS / RocketMQ) | ٢٤.٠٣       | مفتوح 22.03 SZZ ، مفتوح 24.03.03      |
| القدرة العامة على مراقبة أداء التطبيق                                                        | ٢٤.٠٣       | openEuler 24.03.2020                  |
| إمكانية تتبع بروتوكول الارتباط الكامل                                                        | ٢٤.٠٩       | openEuler 24.09.2019 - مقال           |

#### تنميط الأداء

| صفة مميزة                                | وقت الافراج | الإصدار                               |
| ---------------------------------------- | ----------- | ------------------------------------- |
| تشكيل أداء النظام (OnCPU ، Mem)          | ٢٣.٠٣       | openEuler 23.09.2019 - مقال           |
| تحديد أداء النظام (OnCPU ، Mem ، OffCPU) | ٢٣.٠٤       | openEuler 22.03 SP1 ، openEuler 23.03 |
| تشكيل أداء على مستوى الخيط (جافا ، ج)    | ٢٣.٠٦       | openEuler 22.03 SP1 ، openEuler 23.03 |

#### توافق الإصدار

| صفة مميزة                               | وقت الافراج | الإصدار                          |
| --------------------------------------- | ----------- | -------------------------------- |
| دعم التوافق مع إصدار إصدار kernel       | ٢٣.١٢       | مفتوح 22.03 SZZ ، مفتوح 24.03.03 |
| دعم التوافق عبر إصدارات kernel الرئيسية | ٢٤.٠٩       | openEuler 24.09.2019 - مقال      |
|                                         |             |                                  |

#### قابلة للبرمجة وقابلة للتوسيع

| صفة مميزة                                                           | وقت الافراج | الإصدار                     |
| ------------------------------------------------------------------- | ----------- | --------------------------- |
| تكامل غير تدخلي لتحقيقات الطرف الثالث                               | ٢٢.١٢       | openEuler 22.03 SP1         |
| تكامل غير تدخلي لشفرة مصدر eBPF لجهة خارجية                         | ٢٤.٠٣       | openEuler 23.09.2019 - مقال |
| يقوم برنامج تشغيل اللغة الكبيرة تلقائيًا بإنشاء تحقيقات مراقبة eBPF | ٢٤.٠٩       | openEuler 24.09.2019 - مقال |

#### قدرات النشر والتكامل

| صفة مميزة                                     | وقت الافراج | الإصدار                               |
| --------------------------------------------- | ----------- | ------------------------------------- |
| دعم الإرساء مصدر بروميثيوس                    | ٢٢.١٢       | openEuler 22.03 SP1                   |
| دعم الالتحام في شكل ملفات السجل               | ٢٢.١٢       | openEuler 22.03 SP1                   |
| دعم رسو عميل kafka                            | ٢٢.١٢       | openEuler 22.03 SP1                   |
| دعم واجهة REST الديناميكية لرصد مسبار التغيير | ٢٣.٠٦       | openEuler 22.03 SP1 ، openEuler 23.03 |
